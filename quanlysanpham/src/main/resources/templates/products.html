<!DOCTYPE html>
<html lang="en" xmlns:th="https://www.thymeleaf.org/">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <script>
    function clearFilter() {
        window.location.href = "http://localhost:8080/products";
    }
    </script>
    <div>
        <div align="left">
            <form th:action="@{/}" method="get">
                <button type="submit">Home</button>
            </form>
        </div>
        <div align="right">
            <span th:text="${#authentication.name}"></span>
            <form th:action="@{/logout}" method="post">
                <button type="submit">Logout</button>
            </form>
        </div>
    </div>
    <div align="center">
        <h1>List products</h1>
        <h2>
            <a sec:authorize="hasRole('ROLE_ADMIN')" th:href="@{/products/new}"> Add New Product</a>
        </h2>
    </div>
    <div align="center">
        <div>
            <form th:action="@{/products/page/1}">
                Filter : 
                <input th:unless="${keyword.equals('null')}" type="text" name="keyword" width="80px" th:value="${keyword}" required/>&nbsp;
                <input th:if="${keyword.equals('null')}" type="text" name="keyword" width="80px" required/>&nbsp;
                <input type="hidden" name="sortDir"  th:value="${sortDir}"/>
                <input type="hidden" name="sortField"  th:value="${sortField}"/>
                <input type="submit" value="Search" />
                <input type="button" value="Clear" onclick="clearFilter()"/>
            </form>
            &nbsp;
        </div>
        <table border="1px" cellpadding="4px" width="500px">
            <tr>
                <th>
                    <a th:href="@{'/products/page/' + ${pageNumber} + '?keyword=' + ${keyword} +'&sortField=id&sortDir='+${sortDir}}">ID</a>
                </th>
                <th>
                    <a th:href="@{'/products/page/' + ${pageNumber} + '?keyword=' + ${keyword} +'&sortField=name&sortDir='+${sortDir}} ">Product Name</a>
                </th>
                <th>
                    <a th:href="@{'/products/page/' + ${pageNumber} + '?keyword=' + ${keyword} +'&sortField=category&sortDir='+${sortDir}} ">Categoy Name</a>
                </th>
                <th sec:authorize="hasRole('ROLE_ADMIN')">Actions</th>
            </tr>
            <th:block th:each="pro : ${listProducts}">
                <tr align="center">
                    <td>[[${pro.id}]]</td>
                    <td>[[${pro.name}]]</td>
                    <td>[[${pro.category}]]</td>
                    <td sec:authorize="hasRole('ROLE_ADMIN')" width="20%">
                        <a th:href="@{'/products/edit/' + ${pro.id}}">Edit</a> &nbsp;
                        <a th:href="@{'/products/delete/' + ${pro.id}}">Delete</a>
                    </td>
                </tr>
            </th:block>
        </table>
        <div>
            Total Elements : [[${totalElements}]] - Page [[${pageNumber}]]  of [[${totalPages}]] - 
            <span th:each="i : ${#numbers.sequence(1, totalPages)}">
                <a th:if="${i != pageNumber}" th:href="@{'/products/page/' + ${i} + '?keyword=' + ${keyword}} +'&sortField=' + ${sortField} + '&sortDir='+${sortDir}">[[${i}]]</a>
                <span th:unless="${i != pageNumber}">[[${i}]]</span> &nbsp;
            </span>
        </div>
    </div>
</body>
</html>